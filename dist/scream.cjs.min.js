"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},AmpEnvelope=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;classCallCheck(this,t),this.context=e,this.output=this.context.createGain(),this.output.gain.value=n,this.partials=[],this.velocity=0,this.gain=n,this._attack=0,this._decay=.001,this._sustain=this.output.gain.value,this._release=.001}return createClass(t,[{key:"on",value:function(t){this.velocity=t/127,this.start(this.context.currentTime)}},{key:"off",value:function(t){return this.stop(this.context.currentTime)}},{key:"start",value:function(t){this.output.gain.value=0,this.output.gain.setValueAtTime(0,t),this.output.gain.setTargetAtTime(1,t,this.attack+1e-5),this.output.gain.setTargetAtTime(this.sustain*this.velocity,t+this.attack,this.decay)}},{key:"stop",value:function(t){this.sustain=this.output.gain.value,this.output.gain.cancelScheduledValues(t),this.output.gain.setValueAtTime(this.sustain,t),this.output.gain.setTargetAtTime(0,t,this.release+1e-5)}},{key:"connect",value:function(t){this.output.connect(t)}},{key:"attack",set:function(t){this._attack=t},get:function(){return this._attack}},{key:"decay",set:function(t){this._decay=t},get:function(){return this._decay}},{key:"sustain",set:function(t){this.gain=t,this._sustain},get:function(){return this.gain}},{key:"release",set:function(t){this._release=t},get:function(){return this._release}}]),t}(),FILTER_TYPES=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"],FFT_TYPES={FREQUENCY:0,TIME:1,FREQUENCY8:2,TIME8:3},BASE_SAMPLE_TUNING=261.625565,Filter=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FILTER_TYPES[0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;arguments.length>3&&void 0!==arguments[3]&&arguments[3];classCallCheck(this,t),this.context=e,this.destination=this.context.createBiquadFilter(),this.type=n,this.cutoff=i,this.resonance=.5,this.envelopeAmount=1,this.envelope={a:0,d:.5,s:this.cutoff,r:.5}}return createClass(t,[{key:"on",value:function(t){this.start(this.context.currentTime,t.frequency)}},{key:"off",value:function(){return this.stop(this.context.currentTime)}},{key:"start",value:function(t){return this.destination.frequency.setTargetAtTime(this.sustain,t+this.attack,this.decay+.001)}},{key:"stop",value:function(t){return this.destination.frequency.setTargetAtTime(this.cutoff,t,this.release)}},{key:"connect",value:function(t){this.destination.connect(t)}},{key:"type",set:function(t){this.destination.type=t},get:function(){return this.destination.type}},{key:"cutoff",set:function(t){this.destination.frequency.value=t},get:function(){return this.destination.frequency.value}},{key:"Q",set:function(t){this.destination.Q.value=t},get:function(){return this.destination.Q.value}},{key:"attack",set:function(t){this.envelope.a=t},get:function(){return this.envelope.a}},{key:"decay",set:function(t){this.envelope.d=t},get:function(){return this.envelope.d}},{key:"sustain",set:function(t){this.cutoff=t},get:function(){return this.cutoff}},{key:"release",set:function(t){this.envelope.r=t},get:function(){return this.envelope.r}}]),t}(),SAMPLE_BUFFER_SIZE=1024,RECORD_MODE={USER_MEDIA:"USER_MEDIA",STREAM:"STREAM"},Sample=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:RECORD_MODE.USER_MEDIA;classCallCheck(this,t),this.recordMode=n,this._recordStream=null,this.recordMode===RECORD_MODE.USER_MEDIA?this.recordInput=e.createGain():this.recordInput=e.createMediaStreamDestination(),this.context=e,this.buffer=this.context.createBuffer(2,1,this.context.sampleRate),this.rawBuffer=new Float32Array(this.buffer.length),this.buffer.copyFromChannel(this.rawBuffer,1,0),this.stream=null,this._recordProcessor=null,this.overdub=!1}return createClass(t,[{key:"load",value:function(t){var e=this;return fetch(t).then(function(t){return t.arrayBuffer()}).then(function(t){return e.context.decodeAudioData(t)}).then(function(t){return e.rawBuffer=new Float32Array(e.buffer.length),e.rawBuffer=t.getChannelData(0),e.buffer=e.context.createBuffer(2,e.rawBuffer.length,e.context.sampleRate),e.buffer.copyToChannel(e.rawBuffer,0),e.buffer.copyToChannel(e.rawBuffer,1),e})}},{key:"reverse",value:function(){var t=new Float32Array(this.rawBuffer);t.reverse(),this.buffer=this.context.createBuffer(2,t.length,this.context.sampleRate),this.buffer.copyToChannel(t,0),this.buffer.copyToChannel(t,1)}},{key:"pingpong",value:function(){var t=this.rawBuffer.length,e=new Float32Array(2*t),n=new Float32Array(this.rawBuffer);n.reverse(),e.set(this.rawBuffer,0),e.set(n,t-1),this.buffer=this.context.createBuffer(2,e.length,this.context.sampleRate),this.buffer.copyToChannel(e,0),this.buffer.copyToChannel(e,1)}},{key:"normal",value:function(){this.buffer=this.context.createBuffer(2,this.rawBuffer.length,this.context.sampleRate),this.buffer.copyToChannel(this.rawBuffer,0),this.buffer.copyToChannel(this.rawBuffer,1)}},{key:"record",value:function(){var t=this;switch(this.recordMode){case RECORD_MODE.STREAM:this.recordStream(this.recordInput.stream);break;case RECORD_MODE.USER_MEDIA:navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){return t.recordStream(e)})}}},{key:"recordStream",value:function(t){var e=this;this.buffered=0,this.stream=new Float32Array(0),this._recordStream=this.context.createMediaStreamSource(t),this._recordProcessor=this.context.createScriptProcessor(SAMPLE_BUFFER_SIZE,1,2),this._recordStream.connect(this._recordProcessor),this._recordProcessor.connect(this.context.destination),this._recordProcessor.onaudioprocess=function(t){var n=t.inputBuffer.getChannelData(0),i=new Float32Array(e.stream.length+n.length);i.set(e.stream),i.set(n,n.length*e.buffered),e.stream=i,e.buffered++}}},{key:"stopRecording",value:function(){this._recordStream.disconnect(this._recordProcessor),this._recordProcessor.disconnect(this.context.destination),this._recordProcessor.onaudioprocess=null,this.rawBuffer=new Float32Array(this.stream.length),this.rawBuffer=this.ramp(this.stream),this.buffer=this.context.createBuffer(2,this.stream.length,this.context.sampleRate),this.buffer.copyToChannel(this.rawBuffer,0),this.buffer.copyToChannel(this.rawBuffer,1)}},{key:"ramp",value:function(t){var e=t;if(e.length>512){for(var n=0;n<512;n++)e[n]=e[n]*n/512;for(var i=512,n=e.length-512;n<e.length;n++)i--,e[n]=e[n]*i/512}return e}},{key:"overwrite",value:function(){this._recordProcessor.disconnect();var t=0;t=this.stream.length>this.buffer.length?this.stream.length:this.buffer.length;var e=new Float32Array(t),n=this.stream,i=new Float32Array(this.buffer.length);this.buffer.copyFromChannel(i,1,0);for(var s=0;s<t;s++){var o=0,a=0;void 0!=n[s]&&(o=n[s]),void 0!=i[s]&&(a=i[s]),e[s]=o+a}this.rawBuffer=this.ramp(e),this.buffer=this.context.createBuffer(2,t,this.context.sampleRate),this.buffer.copyToChannel(this.rawBuffer,0),this.buffer.copyToChannel(this.rawBuffer,1),this.overdub=!1}}]),t}(),SampleMap=function(){function t(e,n){classCallCheck(this,t),this.context=e,this.input_map=n,this.samples={},this.loaded=!1}return createClass(t,[{key:"load",value:function(){var t=this,e=[];return this.input_map.forEach(function(n){var i=new Sample(t.context);i.load(n.src).then(function(){t.samples[n.value]=Object.assign(n,{sample:i})}),e.push(i)}),Promise.all(e)}}]),t}(),Effect=function(){function t(e){classCallCheck(this,t),this.name="effect",this.context=e,this.input=this.context.createGain(),this.effect=null,this.bypassed=!1,this.output=this.context.createGain(),this.setup(),this.wireUp()}return createClass(t,[{key:"bypass",value:function(t){t!=this.bypassed&&(this.bypassed=t,t?(this.input.connect(this.output),this.input.disconnect(this.effect)):(this.input.connect(this.effect),this.input.disconnect(this.output)))}},{key:"setup",value:function(){this.effect=this.context.createGain()}},{key:"wireUp",value:function(){this.input.connect(this.effect),this.effect.connect(this.output)}},{key:"connect",value:function(t){this.output.connect(t)}}]),t}(),Chorus=function(t){function e(){classCallCheck(this,e);var t=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.name="chorus",t}return inherits(e,t),e}(Effect),Filter$1=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FILTER_TYPES[0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.9;classCallCheck(this,e);var o=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o.name="filter",o.effect.frequency.value=i,o.effect.Q.value=s,o.effect.type=n,o}return inherits(e,t),createClass(e,[{key:"setup",value:function(){this.effect=this.context.createBiquadFilter(),this.effect.connect(this.output)}}]),e}(Effect),Delay=function(t){function e(t){classCallCheck(this,e);var n=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name="delay",n}return inherits(e,t),createClass(e,[{key:"setup",value:function(){this.effect=this.context.createDelay(),this.effect.delayTime.value=.5,this.dry=this.context.createGain(),this.wet=this.context.createGain(),this.feedback=this.context.createGain(),this.feedback.gain.value=.75,this.filter=new Filter$1(this.context,"bandpass",1e3,.3)}},{key:"wireUp",value:function(){this.input.connect(this.dry),this.dry.connect(this.output),this.wet.connect(this.output),this.input.connect(this.effect),this.effect.connect(this.wet),this.effect.connect(this.filter.input),this.filter.connect(this.feedback),this.feedback.connect(this.effect)}},{key:"feedbackAmount",set:function(t){var e=t;e>.98&&(e=.98),this.feedback.gain.value=e},get:function(){return this.feedback.gain.value}},{key:"filterFrequency",set:function(t){this.filter.effect.frequency.value=t},get:function(){return this.filter.effect.frequency.value}},{key:"filterQ",set:function(t){this.filter.effect.Q.value=t},get:function(){return this.filter.effect.Q.value}}]),e}(Effect),FFT=function(t){function e(t){classCallCheck(this,e);var n=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name="fft",n.mode=FFT_TYPES.FREQUENCY,n}return inherits(e,t),createClass(e,[{key:"setup",value:function(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","fft"),this.ctx=this.canvas.getContext("2d"),this.ctx.canvas.width=512,this.ctx.canvas.height=512,this.effect=this.context.createAnalyser(),this.effect.fftSize=2048,this.effect.maxDecibels=-50,this.effect.minDecibels=-120,this.effect.smoothingTimeConstant=.9,this.effect.connect(this.output)}},{key:"data",value:function(){switch(this.mode){case FFT_TYPES.FREQUENCY:var t=new Float32Array(this.effect.frequencyBinCount);this.effect.getFloatFrequencyData(t);break;case FFT_TYPES.TIME:var t=new Float32Array(this.effect.frequencyBinCount);this.effect.getFloatTimeDomainData(t);break;case FFT_TYPES.FREQUENCY8:case FFT_TYPES.TIME8:var t=new Uint8Array(this.effect.frequencyBinCount);this.effect.getByteTimeDomainData(t)}return t}},{key:"draw",value:function(){var t=this,e=this.data(),n=this.ctx;n.save(),n.fillStyle="rgb(33,33,99)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore();var i=0,s=n.canvas.width/e.length,o=.5*n.canvas.height;n.beginPath(),n.moveTo(0,o),n.strokeStyle="rgb(100,255,255)",n.lineWidth=5;for(var a in e)n.lineTo(s*i,o+e[a]*o*10),i++;n.moveTo(s,o),n.stroke(),window.requestAnimationFrame(function(){t.draw()})}},{key:"addToElement",value:function(t){t.appendChild(this.element)}},{key:"element",get:function(){return this.canvas}}]),e}(Effect),Voice=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sawtooth",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;classCallCheck(this,t),this.context=e,this.type=n,this.value=-1,this.gain=i,this.output=this.context.createGain(),this.partials=[],this.output.gain.value=this.gain,this.ampEnvelope=new AmpEnvelope(this.context),this.ampEnvelope.connect(this.output)}return createClass(t,[{key:"init",value:function(){var t=this.context.createOscillator();t.type=this.type,t.connect(this.ampEnvelope.output),t.start(this.context.currentTime),this.partials.push(t)}},{key:"on",value:function(t){this.value=t.value,this.partials.forEach(function(e){e.frequency.value=t.frequency}),this.ampEnvelope.on(t.velocity||t)}},{key:"off",value:function(t){var e=this;this.ampEnvelope.off(t),this.partials.forEach(function(t){t.stop(e.context.currentTime+4*e.ampEnvelope.release)})}},{key:"connect",value:function(t){this.output.connect(t)}},{key:"attack",set:function(t){this.ampEnvelope.attack=t},get:function(){return this.ampEnvelope.attack}},{key:"decay",set:function(t){this.ampEnvelope.decay=t},get:function(){return this.ampEnvelope.decay}},{key:"sustain",set:function(t){this.ampEnvelope.sustain=t},get:function(){return this.ampEnvelope.sustain}},{key:"release",set:function(t){this.ampEnvelope.release=t},get:function(){return this.ampEnvelope.release}}]),t}(),Noise=function(t){function e(t,n){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return i._length=2,i}return inherits(e,t),createClass(e,[{key:"init",value:function(){for(var t=new Float32Array(this.length*this.context.sampleRate),e=new Float32Array(this.length*this.context.sampleRate),n=0;n<this.length*this.context.sampleRate;n++)t[n]=Math.random(),e[n]=Math.random();var i=this.context.createBuffer(2,this.length*this.context.sampleRate,this.context.sampleRate);i.copyToChannel(t,0),i.copyToChannel(e,1);var s=this.context.createBufferSource();s.buffer=i,s.loop=!0,s.loopStart=0,s.loopEnd=2,s.start(this.context.currentTime),s.connect(this.ampEnvelope.output),this.partials.push(s)}},{key:"on",value:function(t){this.value=t.value,this.ampEnvelope.on(t.velocity||t)}},{key:"length",get:function(){return this._length||2},set:function(t){this._length=t}}]),e}(Voice),Reverb=function(t){function e(t){classCallCheck(this,e);var n=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name="reverb",n.attack=0,n.decay=.2,n.release=.8,n}return inherits(e,t),createClass(e,[{key:"setup",value:function(){this.effect=this.context.createConvolver(),this.reverbTime=2,this.attack=0,this.decay=.2,this.release=.8,this.wet=this.context.createGain(),this.wet.gain.value=1,this.dry=this.context.createGain(),this.dry.gain.value=1,this.buffer=this.renderTail(),this.wireUp()}},{key:"wireUp",value:function(){this.input.connect(this.dry),this.input.connect(this.effect),this.dry.connect(this.output),this.effect.connect(this.wet),this.wet.connect(this.output)}},{key:"renderTail",value:function(){var t=this,e=new OfflineAudioContext(2,this.context.sampleRate*this.reverbTime,this.context.sampleRate),n=new Noise(e,1);n.init(),n.connect(e.destination),n.attack=this.attack,n.decay=this.decay,n.release=this.release;var i=e.startRendering().then(function(e){t.effect.buffer=e});return n.on(100),n.off(),i}},{key:"decayTime",set:function(t){var e=t/3;this.reverbTime=t,this.attack=0,this.decay=e,this.release=e,this.buffer=this.renderTail()}}]),e}(Effect),MAX=1,MIN=0,DEFAULT=1,WINDOW_SIZE=512,Saturate=function(t){function e(t){classCallCheck(this,e);var n=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name="saturate",n._amount=DEFAULT,n.canvas=document.createElement("canvas"),n.canvas.setAttribute("id","saturate"),n.ctx=n.canvas.getContext("2d"),n.ctx.canvas.width=512,n.ctx.canvas.height=512,window.requestAnimationFrame(function(){n.draw()}),n}return inherits(e,t),createClass(e,[{key:"setup",value:function(){this.effect=this.context.createWaveShaper(),this.effect.curve=this.createCurve(),console.log(this.effect.curve),this.effect.oversample="4x"}},{key:"createCurve",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DEFAULT,e=new Float32Array(WINDOW_SIZE),n=0,i=0;i<WINDOW_SIZE;i++){var n=1-i/WINDOW_SIZE*2;e[i]=this.f(n,t)}return e}},{key:"f",value:function(t){return t*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:DEFAULT)}},{key:"draw",value:function(){var t=this,e=this.ctx;e.save(),e.globalAlpha=.5,e.fillStyle="rgb(33,33,99)",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore();for(var n=0;n<this.effect.curve.length;n++){var i=this.effect.curve[n];e.fillStyle="rgb(100,255,255)",e.fillRect(n,.5*WINDOW_SIZE+i*WINDOW_SIZE,1,1)}window.requestAnimationFrame(function(){t.draw()})}},{key:"addToElement",value:function(t){t.appendChild(this.element)}},{key:"amount",set:function(t){this._amount=1+(MIN+t*MAX),this.effect.curve=this.createCurve(this._amount)},get:function(){return this._amount}},{key:"element",get:function(){return this.canvas}}]),e}(Effect),ComplexVoice=function(t){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;classCallCheck(this,e);var a=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"none"));return a.type=n,a.widen=s,a.analog=o,a.amount=i,a.output.gain.value=1/i,a}return inherits(e,t),createClass(e,[{key:"init",value:function(){for(var t=this.amount,e=0;e<t;e++){var n=this.context.createOscillator();if(n.type=this.type,e>0){var i=e/t*this.widen;e%1==0&&(i=-i),n.detune.value=i+this.analog*Math.random()}n.connect(this.ampEnvelope.output),n.start(this.context.currentTime),this.partials.push(n)}}},{key:"wideness",set:function(t){var e=this;this.widen=t;var n=this.amount;this.partials.forEach(function(t,i){if(i>0){var s=i/n*e.widen;i%1==0&&(s=-s),t.detune.value=s+e.analog*Math.random()}})},get:function(){return this.widen}}]),e}(Voice),SamplePlayer=function(t){function e(t,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:BASE_SAMPLE_TUNING;classCallCheck(this,e);var a=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return a.buffer=a.context.createBufferSource(),a.buffer.buffer=n,a.tune=s,a.loop=i,a.sampleTuneFrequency=o,a._loopstart=0,a._loopend=0,a.loopStart=0,a.loopEnd=1,a}return inherits(e,t),createClass(e,[{key:"init",value:function(){this.buffer.connect(this.ampEnvelope.output),this.buffer.loop=this.loop,this.buffer.loopStart=this._loopstart,this.buffer.loopEnd=this._loopend,this.partials.push(this.buffer)}},{key:"on",value:function(t){var e=this,n=t.frequency;this.value=t.value,this.partials.forEach(function(t){t.start(e.context.currentTime),e.tune&&(t.playbackRate.value=n/e.sampleTuneFrequency)}),this.ampEnvelope.on(t.velocity||t)}},{key:"loopStart",set:function(t){this._loopstart=t*this.loopLength,this.buffer.loopStart=this._loopstart}},{key:"loopEnd",set:function(t){this._loopend=t*this.loopLength,this.buffer.loopEnd=this._loopend}},{key:"loopLength",get:function(){return this.buffer.buffer.duration}}]),e}(Voice),MizzyDevice=function(){function t(e){classCallCheck(this,t),this.context=e,this.output=this.context.createGain(),this.effectInput=this.output,this.voices=[],this.effects=[],this._attack=0,this._decay=.001,this._sustain=this.output.gain.value,this._release=.001}return createClass(t,[{key:"NoteOn",value:function(t){}},{key:"NoteOff",value:function(t){void 0!=this.voices[t.value]&&this.voices[t.value].off(t)}},{key:"onCC",value:function(t){}},{key:"addEffect",value:function(t,e){this.effects.push(new t(this.context))}},{key:"connectEffects",value:function(){this.effectInput=this.effects[0].input;for(var t=this.effects.length-1;t>=0;t--)console.log(this.effects[t]),t==this.effects.length-1?this.effects[t].connect(this.output):this.effects[t].connect(this.effects[t+1].input)}},{key:"connect",value:function(t){this.output.connect(t)}},{key:"disconnect",value:function(t){this.output.disconnect(t)}},{key:"setVoiceValues",value:function(){var t=this;this.voices.forEach(function(e){e.attack=t._attack,e.decay=t._decay,e.sustain=t._sustain,e.release=t._release})}},{key:"attack",set:function(t){this._attack=t,this.setVoiceValues()},get:function(){return this._attack}},{key:"decay",set:function(t){this._decay=t,this.setVoiceValues()},get:function(){return this._decay}},{key:"sustain",set:function(t){this._sustain=t,this.setVoiceValues()},get:function(){return this._sustain}},{key:"release",set:function(t){this._release=t,this.setVoiceValues()},get:function(){return this._release}}]),t}(),Vincent=function(t){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sawtooth",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50;classCallCheck(this,e);var o=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o.oscillatorType=i,o.numberOfOscillators=n,o._wideness=s,o}return inherits(e,t),createClass(e,[{key:"NoteOn",value:function(t){var e=new ComplexVoice(this.context,this.oscillatorType,this.numberOfOscillators);e.init(),e.attack=this.attack,e.decay=this.decay,e.sustain=this.sustain,e.release=this.release,e.connect(this.effectInput),e.on(t),this.voices[t.value]=e}},{key:"wideness",set:function(t){var e=this;this._wideness=t,this.voices.forEach(function(t){return t.wideness=e._wideness})},get:function(){return this._wideness}},{key:"type",set:function(t){}}]),e}(MizzyDevice),VSS30=function(t){function e(t){classCallCheck(this,e);var n=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.sample=new Sample(n.context),n.recording=!1,n._loop=!0,n._loopMode=e.LOOP_MODES.NORMAL,n._reverse=!1,n._loopStart=0,n._loopEnd=1,n}return inherits(e,t),createClass(e,null,[{key:"LOOP_MODES",get:function(){return{NORMAL:"NORMAL",PINGPONG:"PINGPONG"}}}]),createClass(e,[{key:"record",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.recording||(console.log("recording..."),this.recording=!0,this.sample.overdub=n,this.sample.record(),null!=e&&setTimeout(function(){return t.stopRecording()},e))}},{key:"stopRecording",value:function(){this.recording&&(this.recording=!1,this.sample.overdub?this.sample.overwrite():this.sample.stopRecording())}},{key:"NoteOn",value:function(t){var e=new SamplePlayer(this.context,this.sample.buffer,this._loop);e.attack=this.attack,e.decay=this.decay,e.sustain=this.sustain,e.release=this.release,e.loopStart=this._loopStart,e.loopEnd=this._loopEnd,e.init(),e.connect(this.effectInput),e.on(t),this.voices[t.value]=e}},{key:"toggleReverse",value:function(){this.sample.reverse()}},{key:"setSample",value:function(t){this.sample=t,this.setVoiceValues()}},{key:"setVoiceValues",value:function(){var t=this;this.voices.forEach(function(e){e.attack=t._attack,e.decay=t._decay,e.sustain=t._sustain,e.release=t._release,e.loopStart=t._loopStart,e.loopEnd=t._loopEnd})}},{key:"loop",set:function(t){this._loop=t},get:function(){return this._loop}},{key:"loopMode",set:function(t){switch(this._loopMode=t,this._loopMode){case e.LOOP_MODES.PINGPONG:this.sample.pingpong();break;case e.LOOP_MODES.NORMAL:this.sample.normal()}this.setVoiceValues()},get:function(){return this._loopMode}},{key:"loopStart",set:function(t){this._loopStart=t,this.setVoiceValues()},get:function(){return this._loopStart}},{key:"loopEnd",set:function(t){this._loopEnd=t,this.setVoiceValues()},get:function(){return this._loopEnd}},{key:"loopLength",get:function(){return this.sample.buffer.duration}}]),e}(MizzyDevice),DrumMachine=function(t){function e(t,n){classCallCheck(this,e);var i=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.map=n,i}return inherits(e,t),createClass(e,[{key:"NoteOn",value:function(t){if(null!=this.map.samples[t.value]){var e=new SamplePlayer(this.context,this.map.samples[t.value].sample.buffer,!1,!1);e.init(),this.setVoiceValues(),e.connect(this.effectInput),e.on(t),this.voices[t.value]=e}}}]),e}(MizzyDevice),Components={FilterEnvelope:Filter,AmpEnvelope:AmpEnvelope,Sample:Sample,SampleMap:SampleMap},Effects={Chorus:Chorus,Delay:Delay,Filter:Filter$1,Reverb:Reverb,FFT:FFT,Saturate:Saturate},Voices={ComplexVoice:ComplexVoice,Noise:Noise,SamplePlayer:SamplePlayer,Voice:Voice},Synths={VSS30:VSS30,Vincent:Vincent,DrumMachine:DrumMachine};exports.Components=Components,exports.Effects=Effects,exports.Voices=Voices,exports.Synths=Synths;
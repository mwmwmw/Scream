!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Scream=e():t.Scream=e()}(this,function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=4)}([function(t,e,s){"use strict";s.d(e,"c",function(){return i}),s.d(e,"b",function(){return n}),s.d(e,"a",function(){return a});const i=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"],n={FREQUENCY:0,TIME:1,FREQUENCY8:2,TIME8:3},a=261.625565},function(t,e,s){"use strict";s.d(e,"a",function(){return i});class i{constructor(t){this.name="effect",this.context=t,this.input=this.context.createGain(),this.effect=null,this.bypassed=!1,this.output=this.context.createGain(),this.setup(),this.wireUp()}bypass(t){t!=this.bypassed&&(this.bypassed=t,t?(this.input.connect(this.output),this.input.disconnect(this.effect)):(this.input.connect(this.effect),this.input.disconnect(this.output)))}setup(){this.effect=this.context.createGain()}wireUp(){this.input.connect(this.effect),this.effect.connect(this.output)}connect(t){this.output.connect(t)}}},function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return r});var i=s(1),n=s(0);if(t.AnalyserNode&&!t.AnalyserNode.prototype.getFloatTimeDomainData){var a=new Uint8Array(2048);t.AnalyserNode.prototype.getFloatTimeDomainData=function(t){this.getByteTimeDomainData(a);for(var e=0,s=t.length;e<s;e++)t[e]=.0078125*(a[e]-128)}}class r extends i.a{constructor(t){super(t),this.name="fft",this.mode=n.b.FREQUENCY}static get FFT_TYPES(){return n.b}setup(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","fft"),this.ctx=this.canvas.getContext("2d"),this.ctx.canvas.width=512,this.ctx.canvas.height=512,this.effect=this.context.createAnalyser(),this.effect.fftSize=2048,this.effect.maxDecibels=-50,this.effect.minDecibels=-120,this.effect.smoothingTimeConstant=.9,this.effect.connect(this.output)}data(){switch(this.mode){case n.b.FREQUENCY:var t=new Float32Array(this.effect.frequencyBinCount);this.effect.getFloatFrequencyData(t);break;case n.b.TIME:t=new Float32Array(this.effect.frequencyBinCount);this.effect.getFloatTimeDomainData(t);break;case n.b.FREQUENCY8:t=new Uint8Array(this.effect.frequencyBinCount);this.effect.getByteFrequencyDomainData(t);break;case n.b.TIME8:t=new Uint8Array(this.effect.frequencyBinCount);this.effect.getByteTimeDomainData(t)}return t}draw(){const t=this.data();var e=this.ctx;e.save(),e.fillStyle="rgb(33,33,99)",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore();var s=0,i=e.canvas.width/t.length,n=.5*e.canvas.height;for(var a in e.beginPath(),e.moveTo(0,n),e.strokeStyle="rgb(100,255,255)",e.lineWidth=5,t)e.lineTo(i*s,n+t[a]*n*10),s++;e.moveTo(i,n),e.stroke(),window.requestAnimationFrame(()=>{this.draw()})}get element(){return this.canvas}addToElement(t){t.appendChild(this.element)}}}).call(this,s(3))},function(t,e){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(t){"object"==typeof window&&(s=window)}t.exports=s},function(t,e,s){"use strict";s.r(e);class i{constructor(t,e=1){this.context=t,this.output=this.context.createGain(),this.output.gain.value=e,this.partials=[],this.velocity=0,this.gain=e,this._attack=0,this._decay=.001,this._sustain=this.output.gain.value,this._release=.001}on(t){this.velocity=t/127,this.start(this.context.currentTime)}off(t){return this.stop(this.context.currentTime)}start(t){this.output.gain.value=0,this.output.gain.setValueAtTime(0,t),this.output.gain.setTargetAtTime(1,t,this.attack+1e-5),this.output.gain.setTargetAtTime(this.sustain*this.velocity,t+this.attack,this.decay)}stop(t){this.sustain=this.output.gain.value,this.output.gain.cancelScheduledValues(t),this.output.gain.setValueAtTime(this.sustain,t),this.output.gain.setTargetAtTime(0,t,this.release+1e-5)}set attack(t){this._attack=t}get attack(){return this._attack}set decay(t){this._decay=t}get decay(){return this._decay}set sustain(t){this.gain=t,this._sustain}get sustain(){return this.gain}set release(t){this._release=t}get release(){return this._release}connect(t){this.output.connect(t)}}var n=s(0);const a=2048,r={NORMAL:"NORMAL",PING_PONG:"PING_PONG",REVERSE:"REVERSE"},o={USER_MEDIA:"USER_MEDIA",STREAM:"STREAM"};class h{constructor(t,e=o.USER_MEDIA,s=new Float32Array(1)){this.recordMode=e,this._recordStream=null,this.recordMode===o.USER_MEDIA?this.recordInput=t.createGain():this.recordInput=t.createMediaStreamDestination(),this.context=t,this.buffer=this.context.createBuffer(2,s.length,this.context.sampleRate),this.rawBuffer=s.slice(),this.stream=null,this._recordProcessor=null,this.overdub=!1,this.normalize=!1,this.playbackMode=r.NORMAL,this.copyRawToBuffer(this.rawBuffer)}load(t){return fetch(t).then(t=>t.arrayBuffer()).then(t=>new Promise((e,s)=>{this.context.decodeAudioData(t,e,s)})).then(t=>(this.rawBuffer=new Float32Array(this.buffer.length),this.rawBuffer=t.getChannelData(0),this.setBuffer(),this))}reverse(){this.playbackMode=r.REVERSE,this.copyRawToBuffer(this.rawBuffer.slice().reverse())}pingpong(){this.playbackMode=r.PING_PONG;let t=new Float32Array(2*this.rawBuffer.length);t.set(this.rawBuffer,0),t.set(this.rawBuffer.slice().reverse(),this.rawBuffer.length-1),this.copyRawToBuffer(t)}normal(){this.playbackMode=r.NORMAL,this.copyRawToBuffer(this.rawBuffer)}record(t=(()=>{})){switch(this.recordMode){case o.STREAM:this.recordStream(this.recordInput.stream,t);break;case o.USER_MEDIA:navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(e=>this.recordStream(e,t))}}recordStream(t,e=(()=>{})){this.buffered=0,this.stream=new Float32Array(0),this._recordStream=this.context.createMediaStreamSource(t),this._recordProcessor=this.context.createScriptProcessor(a,1,2),this._recordStream.connect(this._recordProcessor),this._recordProcessor.connect(this.context.destination),this._recordProcessor.onaudioprocess=(t=>{let s=t.inputBuffer.getChannelData(0);var i=new Float32Array(this.stream.length+s.length);i.set(this.stream),i.set(s,s.length*this.buffered),this.stream=i,this.buffered++,e(this.stream.length,this.buffered)})}stopRecording(){this._recordStream.disconnect(this._recordProcessor),this._recordProcessor.disconnect(this.context.destination),this._recordProcessor.onaudioprocess=null,this._recordProcessor.disconnect();let t=this.ramp(this.stream);if(this.overdub){let e=this.mixRawBuffers(t,this.rawBuffer);this.rawBuffer=e}else this.rawBuffer=t;this.setBuffer()}setBuffer(){switch(this.playbackMode){case r.NORMAL:this.normal();break;case r.PING_PONG:this.pingpong();break;case r.REVERSE:this.reverse();break;default:this.normal()}}copyRawToBuffer(t){let e=t;this.normalize&&(e=this.normalize(e)),this.buffer=this.context.createBuffer(2,e.length,this.context.sampleRate),this.buffer.copyToChannel(e,0),this.buffer.copyToChannel(e,1)}trim(t){let e=0;for(let s=0;s<t.length;s++)if(t[s]>0){e=s;break}return t.slice(e)}ramp(t){let e=this.trim(t);if(e.length>512){for(let t=0;t<512;t++)e[t]=e[t]*t/512;var s=512;for(let t=e.length-512;t<e.length;t++)s--,e[t]=e[t]*s/512}return e}normalize(t){const e=t.slice();let s=-(1-.98),i=1-.98;return e.forEach(t=>{t>i&&(i=t),t<s&&(s=t)}),e.map(t=>1.96*(t-s)/(i-s)-.98)}mixRawBuffers(t,e){let s=this.getLongestBuffer(t,e),i=new Float32Array(s);for(let n=0;n<s;n++){let s=0,a=0;null!=t[n]&&(s=t[n]),null!=e[n]&&(a=e[n]),i[n]=s+a}return i}getLongestBuffer(t,e){return t.length>e.length?t.length:e.length}}var c=s(1);class u extends c.a{constructor(t,e=n.c[0],s=1e3,i=.9){super(t),this.name="filter",this.effect.frequency.value=s,this.effect.Q.value=i,this.effect.type=e}setup(){this.effect=this.context.createBiquadFilter(),this.effect.connect(this.output)}}var l=s(2);class f{constructor(t,e="sawtooth",s=.1){this.context=t,this.type=e,this.value=-1,this.gain=s,this.output=this.context.createGain(),this.partials=[],this.output.gain.value=this.gain,this.ampEnvelope=new i(this.context),this.ampEnvelope.connect(this.output)}init(){let t=this.context.createOscillator();t.type=this.type,t.connect(this.ampEnvelope.output),t.start(this.context.currentTime),this.partials.push(t)}on(t){this.value=t.value,this.partials.forEach(e=>{e.frequency.value=t.frequency}),this.ampEnvelope.on(t.velocity||t)}off(t){this.ampEnvelope.off(t),this.partials.forEach(t=>{t.stop(this.context.currentTime+4*this.ampEnvelope.release)})}connect(t){this.output.connect(t)}set attack(t){this.ampEnvelope.attack=t}get attack(){return this.ampEnvelope.attack}set decay(t){this.ampEnvelope.decay=t}get decay(){return this.ampEnvelope.decay}set sustain(t){this.ampEnvelope.sustain=t}get sustain(){return this.ampEnvelope.sustain}set release(t){this.ampEnvelope.release=t}get release(){return this.ampEnvelope.release}}class p extends f{constructor(t,e){super(t,e),this._length=2}get length(){return this._length||2}set length(t){this._length=t}init(){var t=new Float32Array(this.length*this.context.sampleRate),e=new Float32Array(this.length*this.context.sampleRate);for(let s=0;s<this.length*this.context.sampleRate;s++)t[s]=1-2*Math.random(),e[s]=1-2*Math.random();let s=this.context.createBuffer(2,this.length*this.context.sampleRate,this.context.sampleRate);s.copyToChannel(t,0),s.copyToChannel(e,1);let i=this.context.createBufferSource();i.buffer=s,i.loop=!0,i.loopStart=0,i.loopEnd=2,i.start(this.context.currentTime),i.connect(this.ampEnvelope.output),this.partials.push(i)}on(t){this.value=t.value,this.ampEnvelope.on(t.velocity||t)}}const d=window.OfflineAudioContext||window.webkitOfflineAudioContext;const m=1,g=0,y=100;class v extends f{constructor(t,e,s=3,i=50,n=5){super(t,"none"),this.type=e,this.widen=i,this.analog=n,this.amount=s,this.output.gain.value=1/s}init(){var t=this.amount;for(let s=0;s<t;s++){let i=this.context.createOscillator();if(i.type=this.type,s>0){var e=s/t*this.widen;s%1==0&&(e=-e),i.detune.value=e+this.analog*Math.random()}i.connect(this.ampEnvelope.output),i.start(this.context.currentTime),this.partials.push(i)}}set wideness(t){this.widen=t;var e=this.amount;this.partials.forEach((t,s)=>{if(s>0){var i=s/e*this.widen;s%1==0&&(i=-i),t.detune.value=i+this.analog*Math.random()}})}get wideness(){return this.widen}}class w extends f{constructor(t,e,s=!0,i=!0,a=n.a){super(t),this.buffer=this.context.createBufferSource(),this.buffer.buffer=e,this.tune=i,this.loop=s,this.sampleTuneFrequency=a,this._loopstart=0,this._loopend=0,this.loopStart=0,this.loopEnd=1}init(){this.buffer.connect(this.ampEnvelope.output),this.buffer.loop=this.loop,this.buffer.loopStart=this._loopstart,this.buffer.loopEnd=this._loopend,this.partials.push(this.buffer)}on(t){let e=t.frequency;this.value=t.value,this.partials.forEach(t=>{t.start(this.context.currentTime),this.tune&&(t.playbackRate.value=e/this.sampleTuneFrequency)}),this.ampEnvelope.on(t.velocity||t)}set loopStart(t){this._loopstart=t*this.loopLength,this.buffer.loopStart=this._loopstart}set loopEnd(t){this._loopend=t*this.loopLength,this.buffer.loopEnd=this._loopend}get loopLength(){return this.buffer.buffer.duration}}class _{constructor(t){this.context=t,this.output=this.context.createGain(),this.effectInput=this.output,this.voices=[],this.effects=[],this._attack=0,this._decay=.001,this._sustain=this.output.gain.value,this._release=.001}NoteOn(t){}NoteOff(t){null!=this.voices[t.value]&&this.voices[t.value].off(t)}onCC(t){}addEffect(t,e){this.effects.push(new t(this.context))}connectEffects(){this.effectInput=this.effects[0].input;for(let t=this.effects.length-1;t>=0;t--)t==this.effects.length-1?this.effects[t].connect(this.output):this.effects[t].connect(this.effects[t+1].input)}connect(t){this.output.connect(t)}disconnect(t){this.output.disconnect(t)}setVoiceValues(){this.voices.forEach(t=>{t.attack=this._attack,t.decay=this._decay,t.sustain=this._sustain,t.release=this._release})}set attack(t){this._attack=t,this.setVoiceValues()}get attack(){return this._attack}set decay(t){this._decay=t,this.setVoiceValues()}get decay(){return this._decay}set sustain(t){this._sustain=t,this.setVoiceValues()}get sustain(){return this._sustain}set release(t){this._release=t,this.setVoiceValues()}get release(){return this._release}}class x extends _{static get LOOP_MODES(){return{NORMAL:"NORMAL",PINGPONG:"PINGPONG"}}constructor(t){super(t),this.sample=new h(this.context),this.recording=!1,this._loop=!0,this._loopMode=x.LOOP_MODES.NORMAL,this._reverse=!1,this._loopStart=0,this._loopEnd=1,this.samplingProgress=0}record(t=2e3,e=!1){return this.samplingProgress=0,new Promise((s,i)=>{let n=this.context.sampleRate*(t/1e3);this.recording||(this.recording=!0,this.sample.overdub=e,this.sample.record(t=>{this.samplingProgress=t/n,t>n&&(this.samplingProgress=1,this.stopRecording(),s(this))}))})}stopRecording(){this.recording&&(this.recording=!1,this.sample.stopRecording())}NoteOn(t){let e=new w(this.context,this.sample.buffer,this._loop);e.attack=this.attack,e.decay=this.decay,e.sustain=this.sustain,e.release=this.release,e.loopStart=this._loopStart,e.loopEnd=this._loopEnd,e.init(),e.connect(this.effectInput),e.on(t),this.voices[t.value]=e}set loop(t){this._loop=t}get loop(){return this._loop}set loopMode(t){this._loopMode=t}set loopStart(t){this._loopStart=t,this.setVoiceValues()}set loopMode(t){switch(this._loopMode=t,this._loopMode){case x.LOOP_MODES.PINGPONG:this.sample.pingpong();break;case x.LOOP_MODES.NORMAL:this.sample.normal()}this.setVoiceValues()}get loopMode(){return this._loopMode}toggleReverse(){this.sample.reverse()}get loopStart(){return this._loopStart}set loopEnd(t){this._loopEnd=t,this.setVoiceValues()}get loopEnd(){return this._loopEnd}get loopLength(){return this.sample.buffer.duration}setSample(t){this.sample=t,this.setVoiceValues()}setVoiceValues(){this.voices.forEach(t=>{t.attack=this._attack,t.decay=this._decay,t.sustain=this._sustain,t.release=this._release,t.loopStart=this._loopStart,t.loopEnd=this._loopEnd})}}s.d(e,"Components",function(){return b}),s.d(e,"Effects",function(){return E}),s.d(e,"Voices",function(){return T}),s.d(e,"Synths",function(){return S}),window.AudioBuffer.prototype.copyToChannel||(window.AudioBuffer.prototype.copyToChannel=function(t,e){this.getChannelData(e).set(t)}),window.AudioBuffer.prototype.copyFromChannel||(window.AudioBuffer.prototype.copyFromChannel=function(t,e){t.set(this.getChannelData(e))});const b={FilterEnvelope:class{constructor(t,e=n.c[0],s=1e3,i=.1){this.context=t,this.destination=this.context.createBiquadFilter(),this.type=e,this.cutoff=s,this.resonance=.5,this.envelopeAmount=1,this.envelope={a:0,d:.5,s:this.cutoff,r:.5}}on(t){this.start(this.context.currentTime,t.frequency)}off(){return this.stop(this.context.currentTime)}set type(t){this.destination.type=t}get type(){return this.destination.type}set cutoff(t){this.destination.frequency.value=t}get cutoff(){return this.destination.frequency.value}set Q(t){this.destination.Q.value=t}get Q(){return this.destination.Q.value}start(t){return this.destination.frequency.setTargetAtTime(this.sustain,t+this.attack,this.decay+.001)}stop(t){return this.destination.frequency.setTargetAtTime(this.cutoff,t,this.release)}set attack(t){this.envelope.a=t}get attack(){return this.envelope.a}set decay(t){this.envelope.d=t}get decay(){return this.envelope.d}set sustain(t){this.cutoff=t}get sustain(){return this.cutoff}set release(t){this.envelope.r=t}get release(){return this.envelope.r}connect(t){this.destination.connect(t)}},AmpEnvelope:i,Sample:h,SampleMap:class{constructor(t,e){this.context=t,this.input_map=e,this.samples={},this.loaded=!1}load(){let t=[];return this.input_map.forEach(e=>{let s=new h(this.context);s.load(e.src).then(()=>{this.samples[e.value]=Object.assign(e,{sample:s})}),t.push(s)}),Promise.all(t)}}},E={Chorus:class extends c.a{constructor(){super(),this.name="chorus"}},Delay:class extends c.a{constructor(t){super(t),this.name="delay"}setup(){this.effect=this.context.createDelay(),this.effect.delayTime.value=.5,this.dry=this.context.createGain(),this.wet=this.context.createGain(),this.feedback=this.context.createGain(),this.feedback.gain.value=.75,this.filter=new u(this.context,"bandpass",1e3,.3)}wireUp(){this.input.connect(this.dry),this.dry.connect(this.output),this.wet.connect(this.output),this.input.connect(this.effect),this.effect.connect(this.wet),this.effect.connect(this.filter.input),this.filter.connect(this.feedback),this.feedback.connect(this.effect)}set feedbackAmount(t){let e=t;e>.98&&(e=.98),this.feedback.gain.value=e}get feedbackAmount(){return this.feedback.gain.value}set filterFrequency(t){this.filter.effect.frequency.value=t}get filterFrequency(){return this.filter.effect.frequency.value}set filterQ(t){this.filter.effect.Q.value=t}get filterQ(){return this.filter.effect.Q.value}},Filter:u,Reverb:class extends c.a{constructor(t){super(t),this.name="reverb",this.attack=0,this.decay=.2,this.release=.8}setup(){this.effect=this.context.createConvolver(),this.reverbTime=2,this.attack=.001,this.decay=.2,this.release=.8,this.wet=this.context.createGain(),this.wet.gain.value=1,this.dry=this.context.createGain(),this.dry.gain.value=1,this.renderTail(),this.wireUp()}wireUp(){this.input.connect(this.dry),this.input.connect(this.effect),this.dry.connect(this.output),this.effect.connect(this.wet),this.wet.connect(this.output)}renderTail(){const t=new d(2,this.context.sampleRate*this.reverbTime,this.context.sampleRate);t.oncomplete=(t=>{this.effect.buffer=t.renderedBuffer});const e=new p(t,1);e.init(),e.connect(t.destination),e.attack=this.attack,e.decay=this.decay,e.release=this.release,e.on({frequency:500,velocity:1}),t.startRendering(),setTimeout(()=>{e.off()},1)}set decayTime(t){let e=t/3;this.reverbTime=t,this.attack=0,this.decay=e,this.release=e,this.renderTail()}},FFT:l.a,Saturate:class extends c.a{constructor(t){super(t),this.name="saturate",this._amount=y}setup(){this.effect=this.context.createWaveShaper(),this.effect.curve=this.createCurve(400),this.effect.oversample="4x"}createCurve(t=y){for(var e=new Float32Array(this.context.sampleRate),s=Math.PI/180,i=0,n=0;n<this.context.sampleRate;n++)i=2*n/this.context.sampleRate-1,e[n]=(3+t)*i*20*s/(Math.PI+t*Math.abs(i));return e}f(t,e=y){return t*e}set amount(t){this._amount=1+(g+t*m),this.effect.curve=this.createCurve(this._amount)}get amount(){return this._amount}get element(){return this.canvas}addToElement(t){t.appendChild(this.element)}}},T={ComplexVoice:v,Noise:p,SamplePlayer:w,Voice:f},S={VSS30:x,Vincent:class extends _{constructor(t,e,s="sawtooth",i=50){super(t),this.oscillatorType=s,this.numberOfOscillators=e,this._wideness=i}NoteOn(t){let e=new v(this.context,this.oscillatorType,this.numberOfOscillators);e.init(),e.attack=this.attack,e.decay=this.decay,e.sustain=this.sustain,e.release=this.release,e.connect(this.effectInput),e.on(t),this.voices[t.value]=e}set wideness(t){this._wideness=t,this.voices.forEach(t=>t.wideness=this._wideness)}get wideness(){return this._wideness}set type(t){}},DrumMachine:class extends _{constructor(t,e){super(t),this.map=e}NoteOn(t){if(null!=this.map.samples[t.value]){let e=new w(this.context,this.map.samples[t.value].sample.buffer,!1,!1);e.init(),this.setVoiceValues(),e.connect(this.effectInput),e.on(t),this.voices[t.value]=e}}}}}])});
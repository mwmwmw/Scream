!function(t){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},s=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e(this,t),this.context=n,this.output=this.context.createGain(),this.output.gain.value=i,this.partials=[],this.velocity=0,this.gain=i,this.envelope={a:0,d:.1,s:this.gain,r:.5}}return n(t,[{key:"on",value:function(t){this.velocity=t/127,this.start(this.context.currentTime)}},{key:"off",value:function(t){return this.stop(this.context.currentTime)}},{key:"start",value:function(t){return this.output.gain.value=0,this.output.gain.setValueAtTime(0,t),this.output.gain.setTargetAtTime(this.sustain*this.velocity,t+this.attack,this.decay+.001)}},{key:"stop",value:function(t){this.output.gain.cancelScheduledValues(t),this.output.gain.setValueAtTime(this.sustain,t),this.output.gain.setTargetAtTime(0,t,this.release)}},{key:"connect",value:function(t){this.output.connect(t)}},{key:"attack",set:function(t){this.envelope.a=t},get:function(){return this.envelope.a}},{key:"decay",set:function(t){this.envelope.d=t},get:function(){return this.envelope.d}},{key:"sustain",set:function(t){this.gain=t,this.envelope.s=t},get:function(){return this.gain}},{key:"release",set:function(t){this.envelope.r=t},get:function(){return this.envelope.r}}]),t}(),c=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"],r=261.625565,a=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c[0],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;arguments.length>3&&void 0!==arguments[3]&&arguments[3];e(this,t),this.context=n,this.destination=this.context.createBiquadFilter(),this.type=i,this.cutoff=o,this.resonance=.5,this.envelopeAmount=1,this.envelope={a:0,d:.5,s:this.cutoff,r:.5}}return n(t,[{key:"on",value:function(t){this.start(this.context.currentTime,t.frequency)}},{key:"off",value:function(){return this.stop(this.context.currentTime)}},{key:"start",value:function(t){return this.destination.frequency.setTargetAtTime(this.sustain,t+this.attack,this.decay+.001)}},{key:"stop",value:function(t){return this.destination.frequency.setTargetAtTime(this.cutoff,t,this.release)}},{key:"connect",value:function(t){this.destination.connect(t)}},{key:"type",set:function(t){this.destination.type=t},get:function(){return this.destination.type}},{key:"cutoff",set:function(t){this.destination.frequency.value=t},get:function(){return this.destination.frequency.value}},{key:"Q",set:function(t){this.destination.Q.value=t},get:function(){return this.destination.Q.value}},{key:"attack",set:function(t){this.envelope.a=t},get:function(){return this.envelope.a}},{key:"decay",set:function(t){this.envelope.d=t},get:function(){return this.envelope.d}},{key:"sustain",set:function(t){this.cutoff=t},get:function(){return this.cutoff}},{key:"release",set:function(t){this.envelope.r=t},get:function(){return this.envelope.r}}]),t}(),u=function(){function t(n){e(this,t),this.context=n,this.buffer=this.context.createBuffer(2,1,this.context.sampleRate),this.stream=null,this._recordProcessor=null}return n(t,[{key:"load",value:function(t){var e=this;return fetch(t).then(function(t){return t.arrayBuffer()}).then(function(t){return e.context.decodeAudioData(t)}).then(function(t){e.buffer=t})}},{key:"record",value:function(){var t=this;this.buffered=0,this.stream=new Float32Array(0),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){var n=t.context.createMediaStreamSource(e);t._recordProcessor=t.context.createScriptProcessor(1024,1,2),n.connect(t._recordProcessor),t._recordProcessor.connect(t.context.destination),t._recordProcessor.onaudioprocess=function(e){var n=e.inputBuffer.getChannelData(0),i=new Float32Array(t.stream.length+n.length);i.set(t.stream),i.set(n,n.length*t.buffered),t.stream=i,t.buffered++}})}},{key:"stopRecording",value:function(){this._recordProcessor.disconnect(),this.buffer=this.context.createBuffer(2,this.stream.length,this.context.sampleRate),this.buffer.copyToChannel(this.stream,0),this.buffer.copyToChannel(this.stream,1)}},{key:"recordInput",value:function(t){}}]),t}(),h=function(){function t(n){e(this,t),this.context=n,this.input=this.context.createGain(),this.effect=null,this.output=this.context.createGain(),this.setup(),this.wireUp()}return n(t,[{key:"setup",value:function(){this.effect=this.context.createGain()}},{key:"wireUp",value:function(){this.input.connect(this.effect),this.effect.connect(this.output)}},{key:"connect",value:function(t){this.output.connect(t)}}]),t}(),f=function(t){function n(){return e(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this))}return i(n,t),n}(h),l=function(t){function s(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c[0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.9;e(this,s);var a=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t));return a.effect.frequency.value=i,a.effect.Q.value=r,a.effect.type=n,a}return i(s,t),n(s,[{key:"setup",value:function(){this.effect=this.context.createBiquadFilter(),this.effect.connect(this.output)}}]),s}(h),p=function(t){function s(t){return e(this,s),o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t))}return i(s,t),n(s,[{key:"setup",value:function(){this.effect=this.context.createDelay(),this.effect.delayTime.value=.5,this.dry=this.context.createGain(),this.wet=this.context.createGain(),this.feedback=this.context.createGain(),this.feedback.gain.value=.75,this.filter=new l(this.context,"lowpass",1e3,.3)}},{key:"wireUp",value:function(){this.input.connect(this.dry),this.dry.connect(this.output),this.wet.connect(this.output),this.input.connect(this.effect),this.effect.connect(this.wet),this.effect.connect(this.filter.input),this.filter.connect(this.feedback),this.feedback.connect(this.effect)}},{key:"feedbackAmount",set:function(t){var e=t;e>.98&&(e=.98),this.feedback.gain.value=e},get:function(){return this.feedback.gain.value}},{key:"filterFrequency",set:function(t){this.filter.effect.frequency.value=t},get:function(){return this.filter.effect.frequency.value}},{key:"filterQ",set:function(t){this.filter.effect.Q.value=t},get:function(){return this.filter.effect.Q.value}},{key:"dry",set:function(t){this.dry.gain.value=t},get:function(){this.dry.gain.value}},{key:"wet",set:function(t){this.wet.gain.value=t},get:function(){this.wet.gain.value}}]),s}(h),v=function(t){function s(t){return e(this,s),o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t))}return i(s,t),n(s,[{key:"setup",value:function(){var t=this;this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","fft"),this.ctx=this.canvas.getContext("2d"),this.ctx.canvas.width=1024,this.ctx.canvas.height=400,this.effect=this.context.createAnalyser(),this.effect.fftSize=1024,this.effect.maxDecibels=-50,this.effect.minDecibels=-120,this.effect.smoothingTimeConstant=.9,this.effect.connect(this.output),window.requestAnimationFrame(function(){t.draw()})}},{key:"draw",value:function(){var t=this,e=new Uint8Array(this.effect.frequencyBinCount);this.effect.getByteFrequencyData(e);var n=this.ctx;n.save(),n.globalAlpha=.5,n.fillStyle="rgb(33,33,99)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore();var i=0,o=n.canvas.width/e.length;for(var s in e)n.fillStyle="rgb(100,255,255)",n.fillRect(o*i,n.canvas.height,o,-e[s]/255*n.canvas.height),i++;window.requestAnimationFrame(function(){t.draw()})}},{key:"addToElement",value:function(t){t.appendChild(this.element)}},{key:"element",get:function(){return this.canvas}}]),s}(h),y=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sawtooth";e(this,t),this.context=n,this.type=i,this.value=-1,this.gain=.1,this.output=this.context.createGain(),this.partials=[],this.output.gain.value=this.gain,this.ampEnvelope=new s(this.context),this.ampEnvelope.connect(this.output)}return n(t,[{key:"init",value:function(){var t=this.context.createOscillator();t.type=this.type,t.connect(this.ampEnvelope.output),t.start(this.context.currentTime),this.partials.push(t)}},{key:"on",value:function(t){this.value=t.value,this.partials.forEach(function(e){e.frequency.value=t.frequency/4}),this.ampEnvelope.on(t.velocity||t)}},{key:"off",value:function(t){var e=this;this.ampEnvelope.off(t),this.partials.forEach(function(t){t.stop(e.context.currentTime+4*e.ampEnvelope.release)})}},{key:"connect",value:function(t){this.output.connect(t)}}]),t}(),d=function(t){function s(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];e(this,s);var n=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,"none"));return n._length=2,n}return i(s,t),n(s,[{key:"init",value:function(){for(var t=new Float32Array(this.length*this.context.sampleRate),e=new Float32Array(this.length*this.context.sampleRate),n=0;n<this.length*this.context.sampleRate;n++)t[n]=Math.random(),e[n]=Math.random();var i=this.context.createBuffer(2,this.length*this.context.sampleRate,this.context.sampleRate);i.copyToChannel(t,0),i.copyToChannel(e,1);var o=this.context.createBufferSource({buffer:i,loop:!0,loopStart:0,loopEnd:2});o.start(this.context.currentTime),o.connect(this.ampEnvelope.output),this.partials.push(o)}},{key:"on",value:function(t){this.value=t.value,this.ampEnvelope.on(t.velocity||t)}},{key:"length",get:function(){return this._length||2},set:function(t){this._length=t}}]),s}(y),g=function(t){function s(t){e(this,s);var n=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t));return n.attack=0,n.decay=.2,n.release=.2,n}return i(s,t),n(s,[{key:"setup",value:function(){this.effect=this.context.createConvolver(),this.reverbTime=1,this.wet=this.context.createGain(),this.wet.gain.value=1,this.dry=this.context.createGain(),this.dry.gain.value=1,this.buffer=this.renderTail()}},{key:"wireUp",value:function(){this.input.connect(this.dry),this.input.connect(this.effect),this.dry.connect(this.output),this.effect.connect(this.wet),this.wet.connect(this.output)}},{key:"renderTail",value:function(){var t=this,e=new OfflineAudioContext(2,this.context.sampleRate*this.reverbTime,this.context.sampleRate),n=(e.createBufferSource(),new d(e,1));return n.init(),n.connect(e.destination),n.attack=this.attack,n.decay=this.decay,n.release=this.release,n.on(100),n.off(),e.startRendering().then(function(e){t.effect.buffer=e})}},{key:"decayTime",set:function(t){var e=t/3;this.reverbTime=t,this.attack=0,this.decay=e,this.release=e,this.buffer=this.renderTail()}},{key:"dry",set:function(t){this.dry.gain.value=t},get:function(){this.dry.gain.value}},{key:"wet",set:function(t){this.wet.gain.value=t},get:function(){this.wet.gain.value}}]),s}(h),m=function(t){function s(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;e(this,s);var a=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,"none"));return a.type=n,a.widen=c,a.analog=r,a.amount=i,a.output.gain.value=1/i,a}return i(s,t),n(s,[{key:"init",value:function(){for(var t=this.amount,e=0;e<t;e++){var n=this.context.createOscillator();if(n.type=this.type,e>0){var i=e/t*this.widen;e%1==0&&(i=-i),n.detune.value=i+this.analog*Math.random()}n.connect(this.ampEnvelope.output),n.start(this.context.currentTime),this.partials.push(n)}}},{key:"wideness",set:function(t){var e=this;this.widen=t;var n=this.amount;this.partials.forEach(function(t,i){if(i>0){var o=i/n*e.widen;i%1==0&&(o=-o),t.detune.value=o+e.analog*Math.random()}})},get:function(){return this.widen}}]),s}(y),k=function(t){function s(t,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;e(this,s);var a=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t));return a.buffer=a.context.createBufferSource(n),a.buffer.buffer=n,a.loop=i,a.sampleTuneFrequency=c,a}return i(s,t),n(s,[{key:"init",value:function(){var t=this.buffer;t.connect(this.ampEnvelope.output),t.loop=this.loop,this.partials.push(t)}},{key:"on",value:function(t){var e=this,n=t.frequency;this.value=t.value,this.partials.forEach(function(t){t.start(e.context.currentTime),t.playbackRate.value=n/e.sampleTuneFrequency}),this.ampEnvelope.on(t.velocity||t)}}]),s}(y),x=function(){function t(n){e(this,t),this.context=n,this.output=this.context.createGain(),this.effectInput=this.output,this.voices=[],this.effects=[],this.effectInput=this.output}return n(t,[{key:"NoteOn",value:function(t){}},{key:"NoteOff",value:function(t){this.voices[t.value].off(t)}},{key:"onCC",value:function(t){}},{key:"addEffect",value:function(t,e){this.effects.push(new t(this.context))}},{key:"connectEffects",value:function(){this.effectInput=this.effects[0].input;for(var t=this.effects.length-1;t>=0;t--)console.log(this.effects[t]),t==this.effects.length-1?this.effects[t].connect(this.output):this.effects[t].connect(this.effects[t+1].input)}},{key:"connect",value:function(t){this.output.connect(t)}},{key:"disconnect",value:function(t){this.output.disconnect(t)}}]),t}(),w=function(t){function s(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sawtooth",c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50;e(this,s);var r=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t));return r.oscillatorType=i,r.numberOfOscillators=n,r._wideness=c,r}return i(s,t),n(s,[{key:"NoteOn",value:function(t){var e=new m(this.context,this.oscillatorType,this.numberOfOscillators);e.init(),e.connect(this.effectInput),e.on(t),this.voices[t.value]=e}},{key:"wideness",set:function(t){var e=this;this._wideness=t,this.voices.forEach(function(t){return t.wideness=e._wideness})},get:function(){return this._wideness}},{key:"type",set:function(t){}}]),s}(x),b=function(t){function s(t){e(this,s);var n=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t));return n.sample=new u(n.context),n.recording=!1,n}return i(s,t),n(s,[{key:"record",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.recording||(console.log("recording..."),this.recording=!0,this.sample.record(),null!=e&&setTimeout(function(){return t.stopRecording()},e))}},{key:"stopRecording",value:function(){this.recording&&(this.recording=!1,this.sample.stopRecording(),console.log("stop recording.",this.sample.buffer.length))}},{key:"NoteOn",value:function(t){var e=new k(this.context,this.sample.buffer,!0);e.init(),e.connect(this.effectInput),e.on(t),this.voices[t.value]=e}}]),s}(x),_={FilterEnvelope:a,AmpEnvelope:s,Sample:u},T={Chorus:f,Delay:p,Filter:l,Reverb:g,FFT:v},O={ComplexVoice:m,Noise:d,SamplePlayer:k,Voice:y},E={VSS30:b,Vincent:w};t.Components=_,t.Effects=T,t.Voices=O,t.Synths=E}(this.Scream=this.Scream||{});
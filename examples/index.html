<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body {margin:0; overflow: hidden;}
        canvas {width: 100vw; height: 100vh;}
    </style>
</head>
<body>
<script src="https://cdn.rawgit.com/mwmwmw/Mizzy/710978b6/dist/mizzy.min.js" type="application/javascript"></script>
<script src="js/scream.js" type="application/javascript"></script>
<script>

    console.log(Scream);

	var Audio = new (window.AudioContext || window.webkitAudioContext)();

	var vssConnected = false;
	var vss30 = new Scream.Synths.VSS30(Audio);

	var vincentConnected = false;
	var vincent = new Scream.Synths.Vincent(Audio, 16, "sawtooth", 60);
	vincent.addEffect( Scream.Effects.Filter);
	vincent.addEffect( Scream.Effects.Reverb);
	vincent.connectEffects();

	var fft = new  Scream.Effects.FFT(Audio);
	fft.connect(Audio.destination);

	var m = new Mizzy();
	m.initialize().then(() => {
		m.bindToAllInputs();
		m.bindKeyboard();
		m.keyToggle((e) => {
			vincent.NoteOn(e);
			vss30.NoteOn(e);
		}, (e) => {
			vincent.NoteOff(e);
			vss30.NoteOff(e);
		});

		m.onCC(1, (e) => {
			vincent.effects[0].effect.frequency.value = 50 + (e.ratio * 8000)
		});
		m.onCC(2, (e) => {
			vincent.wideness = e.ratio * 300;
		});
	});

	window.addEventListener("keyup", (e) => {
		switch (e.keyCode) {
			case 192:
				vss30.stopRecording();
				break;
		}
	});

	window.addEventListener("keydown", (e) => {
		console.log(e.keyCode);
		switch (e.keyCode) {
			case 192:
				if (vssConnected) {
					vss30.record();
				}
				break;
			case 49:
				if (!vssConnected) {
					console.log("VSS Connected");
					vss30.connect(fft.input);
				} else {
					console.log("VSS Disconnected");
					vss30.disconnect(fft.input);
				}
				vssConnected = !vssConnected;
				break;
			case 50:
				if (!vincentConnected) {
					console.log("Vincent Connected");
					vincent.connect(fft.input);
				} else {
					console.log("Vincent Disconnected");
					vincent.disconnect(fft.input);
				}
				vincentConnected = !vincentConnected;
				break;
		}

	});

	window.addEventListener("mousemove", (e) => {
		var x = Math.round((e.pageX / window.innerWidth) * 127);
		var y = Math.round((e.pageY / window.innerHeight) * 127);
		var xmessage = Mizzy.Generate.CCEvent(1, x);
		m.sendMidiMessage(xmessage);
		var ymessage = Mizzy.Generate.CCEvent(2, y);
		m.sendMidiMessage(ymessage);
	});

	var CanvasContainer = document.createElement("div");
	document.getElementsByTagName("body")[0].appendChild(CanvasContainer);
	fft.addToElement(CanvasContainer);
</script>
</body>
</html>